---
milestone: v1.0
audited: 2026-02-25
status: passed
scores:
  requirements: 10/10
  phases: 1/1
  integration: 3/3
  flows: 3/3
gaps: []
tech_debt:
  - phase: 01-backend-foundation
    items:
      - "clerk_secret_key in config.py is a required field with no reader in Phase 1 — forces operators to set a .env value that has no effect until Phase 3/4; consider making optional or adding .env.example comment"
      - "get_graph_by_session() in repository.py is defined but not called — intentional forward scaffold for Phase 3 history retrieval (documented in docstring)"
      - "Human verification pending: full docker-compose E2E with real Clerk JWT + OPENAI_API_KEY — cannot automate due to live service dependencies"
      - "Redirect hop limit hardcoded at 5 in scraper.py — no configurable timeout-like parameter"
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0 — Backend Foundation
**Audited:** 2026-02-25
**Status:** passed
**Score:** 10/10 requirements satisfied | 1/1 phases verified | 3/3 E2E flows wired

---

## Phase Verification Summary

| Phase | Status | Score | Critical Gaps |
|-------|--------|-------|---------------|
| Phase 1: Backend Foundation | passed | 5/5 must-haves | None |

**01-VERIFICATION.md:** All 5 observable truths verified. All 10 requirements satisfied. 29/29 tests passing. Human verification required for live docker-compose E2E (see tech debt).

---

## Requirements Coverage (3-Source Cross-Reference)

| Requirement | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|-----------------|---------------------|-----------------|--------------|
| INFRA-01 | SATISFIED | 01-01: scaffold at apps/api/ | Complete | **satisfied** |
| INFRA-02 | SATISFIED | 01-01: docker-compose with Neo4j + Redis | Complete | **satisfied** |
| SEC-01 | SATISFIED | 01-02+01-03: validate_url(), allow_redirects=False | Complete | **satisfied** |
| SEC-02 | SATISFIED | 01-03: UNWIND $param Cypher, zero .format() | Complete | **satisfied** |
| SEC-03 | SATISFIED | 01-04: get_current_user via PyJWKClient RS256 | Complete | **satisfied** |
| SEC-04 | SATISFIED | 01-01: app.state.neo4j_driver lifespan singleton | Complete | **satisfied** |
| AI-01 | SATISFIED | 01-05: client.beta.chat.completions.parse + VCKnowledgeGraph | Complete | **satisfied** |
| AI-02 (scraping) | SATISFIED | 01-03: BeautifulSoup lxml, 32k cap | Complete | **satisfied** |
| AI-03 | SATISFIED | 01-05: text branch bypasses scraping | Complete | **satisfied** |
| AI-04 | SATISFIED | 01-02+01-05: validate_input_length() text path only | Complete | **satisfied** |

**Note on AI-02:** Full AI-02 requires Redis URL caching (delivered in Phase 4 with RATE-03). The scraping/extraction sub-requirement is complete in Phase 1. The Redis caching sub-requirement is correctly deferred and tracked separately in REQUIREMENTS.md. This split is intentional and does not affect the Phase 1 milestone status.

**Orphan detection:** 0 requirements in traceability table absent from all VERIFICATION.md files.

---

## Integration Check Results

**Status:** PASSED — all flows wired, no broken connections

### E2E Flows Verified

| Flow | Steps | Status |
|------|-------|--------|
| Text input path | POST /api/generate → auth → validate_input_length → GPT-4o → persist_graph → GenerateResponse | ✓ WIRED |
| URL input path | POST /api/generate → auth → scrape_url [validate_url → fetch → BeautifulSoup] → GPT-4o → persist_graph → GenerateResponse | ✓ WIRED |
| Auth rejection | Bad JWT → 401 before run_generate_pipeline() | ✓ WIRED |

### Plan-to-Plan Links Verified

| Link | Requirement | Code Location | Status |
|------|-------------|---------------|--------|
| `validate_url()` is first call in `scrape_url()` | SEC-01 | `scraper.py:46` | ✓ WIRED |
| `app.state.neo4j_driver` singleton → `get_neo4j_driver()` | SEC-04 | `main.py:11`, `dependencies.py:14` | ✓ WIRED |
| `get_current_user` via `Depends()` before pipeline | SEC-03 | `router.py:14-15` | ✓ WIRED |
| `persist_graph()` called after GPT-4o extraction | AI-01 | `service.py:67,91` | ✓ WIRED |
| `validate_input_length()` on text path only (not URLs) | AI-04 | `service.py:49-60` | ✓ WIRED |

### Integration Advisory (Non-Blocking)

- **`clerk_secret_key` unused in Phase 1:** Declared as required field in `config.py` but nothing reads it. Will cause `.env` setup friction for developers — they must set it even though Phase 1 never uses it. Recommend making optional or adding `.env.example` documentation. Not a runtime failure.

---

## Tech Debt

### Phase 1: Backend Foundation

| Item | Severity | Recommendation |
|------|----------|----------------|
| `clerk_secret_key` required but unused in Phase 1 | Info | Make optional (`clerk_secret_key: str = ""`) or document in `.env.example` that it's reserved for Phase 3 |
| `get_graph_by_session()` defined but not called | Info | Intentional forward scaffold — no action needed; remove note when Phase 3 uses it |
| Human verification pending: full docker-compose E2E | Info | Manual step required before declaring production-ready |
| Redirect hop limit hardcoded at 5 in `scraper.py` | Info | Low risk for an MVP; consider making configurable in Phase 4 |

**Total: 4 items, 0 blockers, all Info severity**

---

## Anti-Patterns Found

| File | Pattern | Severity | Assessment |
|------|---------|----------|------------|
| `apps/api/app/auth/clerk.py:19` | f-string for JWKS URL construction | Info | Not a Cypher query; `clerk.py` does not import neo4j; SEC-02 does not apply |

**No blocker or warning anti-patterns found.**

---

## Milestone Definition of Done

Phase 1 delivers: a working FastAPI service that accepts text or URL input, scrapes safely, extracts crypto VC entities via GPT-4o, persists graphs to Neo4j, and is free of the SSRF, Cypher injection, and JWT vulnerabilities inherited from the Flask codebase.

All 5 success criteria verified:
1. ✓ `docker-compose up` + `POST /api/generate` returns structured graph (automated + human verification pending live test)
2. ✓ SSRF rejection of 127.0.0.1 / 10.0.0.1 with 400 (9 automated tests)
3. ✓ Zero string interpolation in Neo4j queries (grep confirmed, SEC-02)
4. ✓ Invalid JWT → 401 before business logic (automated tests)
5. ✓ Input < 200 chars → 400 with exact message (exact string match tested)

---

*Audited: 2026-02-25*
*Auditor: Claude (gsd-integration-checker + orchestrator cross-reference)*
*Tests at audit time: 29/29 passing*
