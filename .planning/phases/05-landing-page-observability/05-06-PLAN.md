---
phase: 05-landing-page-observability
plan: "06"
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/components/landing/HeroSection.tsx
autonomous: true
requirements: [FE-04]
gap_closure: true

must_haves:
  truths:
    - "After submitting text in the hero textarea, the generated graph renders visually in the right column"
    - "The DemoGraph is replaced by the live result graph when a graph is generated"
    - "A Sign up to save prompt remains visible alongside the rendered graph"
    - "The right column continues to show DemoGraph before any submission"
  artifacts:
    - path: "apps/web/components/landing/HeroSection.tsx"
      provides: "Hero with dynamic GraphCanvas replacing DemoGraph on success"
      contains: "VCGraph | null"
    - path: "apps/web/components/landing/HeroSection.tsx"
      contains: "dynamic(() => import"
  key_links:
    - from: "apps/web/components/landing/HeroSection.tsx"
      to: "GraphCanvas"
      via: "dynamic(() => import('@/components/graph/GraphCanvas'), { ssr: false })"
      pattern: "dynamic.*GraphCanvas.*ssr.*false"
    - from: "apps/web/components/landing/HeroSection.tsx"
      to: "setGraph(data.graph)"
      via: "API success handler"
      pattern: "setGraph\\(data\\.graph\\)"
---

<objective>
Fix HeroSection so that after a successful /api/generate call the actual VCGraph
is stored and rendered in the right column using GraphCanvas, replacing the static
DemoGraph. The existing text-badge "Graph generated — N nodes" success block is
replaced by the live interactive Cytoscape canvas, with the "Sign up to save"
prompt shown as a caption/overlay beneath or beside it.

Purpose: UAT Gap 2 (major) — the hero anonymous trial currently discards the
graph data and renders only a text count badge; the graph never appears visually.
Output: apps/web/components/landing/HeroSection.tsx with VCGraph state + dynamic
GraphCanvas render path
</objective>

<execution_context>
@/Users/uzi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/uzi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/components/landing/HeroSection.tsx
@apps/web/components/graph/GraphCanvas.tsx
@packages/shared-types/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite HeroSection to store VCGraph and render GraphCanvas on success</name>
  <files>apps/web/components/landing/HeroSection.tsx</files>
  <action>
    Rewrite apps/web/components/landing/HeroSection.tsx in full. The changes are:

    1. ADD a dynamic import at the top of the file (after 'use client', before useState):
       ```ts
       import dynamic from 'next/dynamic'
       import type { VCGraph } from '@graphvc/shared-types'

       const GraphCanvas = dynamic(() => import('@/components/graph/GraphCanvas'), { ssr: false })
       ```
       This is MANDATORY — GraphCanvas uses react-cytoscapejs which accesses
       window at module load time and crashes on the server if not wrapped in
       dynamic() with ssr:false. This follows the established pattern from
       apps/web/app/app/page.tsx (Phase 02-04 decision).

    2. CHANGE the state type:
       Replace:
         `const [result, setResult] = useState<{ nodes: number; edges: number } | null>(null)`
       With:
         `const [graph, setGraph] = useState<VCGraph | null>(null)`

    3. CHANGE the API success handler (inside the try block, after res.ok check):
       Replace the block that extracts nodeCount/edgeCount and calls setResult:
       ```ts
       const data = await res.json()
       const nodeCount = data.graph?.nodes?.length ?? 0
       const edgeCount = data.graph?.edges?.length ?? 0
       if (nodeCount === 0) {
         setError('No VC relationships found. Try a more specific funding announcement.')
         return
       }
       setResult({ nodes: nodeCount, edges: edgeCount })
       ```
       With:
       ```ts
       const data = await res.json()
       const vcGraph: VCGraph = data.graph
       if (!vcGraph?.nodes?.length) {
         setError('No VC relationships found. Try a more specific funding announcement.')
         return
       }
       setGraph(vcGraph)
       ```

    4. CHANGE the right column JSX (the `{/* Right — demo graph */}` block):
       Replace:
       ```tsx
       <div className="hidden lg:block h-[500px] rounded-xl overflow-hidden border border-gray-800 bg-gray-900">
         <DemoGraph className="w-full h-full" />
       </div>
       ```
       With:
       ```tsx
       <div className="hidden lg:flex lg:flex-col gap-3">
         <div className="h-[500px] rounded-xl overflow-hidden border border-gray-800 bg-gray-900">
           {graph ? (
             <GraphCanvas
               graph={graph}
               selectedNodeId={null}
               onNodeClick={() => undefined}
             />
           ) : (
             <DemoGraph className="w-full h-full" />
           )}
         </div>
         {graph && (
           <p className="text-gray-400 text-xs text-center">
             {graph.nodes.length} nodes · {graph.edges.length} relationships —{' '}
             <a href="/sign-in" className="text-indigo-400 hover:text-indigo-300 underline">
               Sign up free
             </a>{' '}
             to save and revisit.
           </p>
         )}
       </div>
       ```

    5. REMOVE the left-column inline result block (the block controlled by `result &&`):
       Delete:
       ```tsx
       {result && (
         <div className="rounded-lg border border-emerald-800 bg-emerald-950/50 p-4">
           ...
         </div>
       )}
       ```
       The sign-up prompt is now the caption under the graph in the right column
       (step 4 above). The error block (`{error && ...}`) stays unchanged.

    6. REMOVE the DemoGraph import if DemoGraph is no longer used when graph
       is present — keep it since it's still used as the default right-column
       content before any submission. DemoGraph import stays.

    Notes:
    - GraphCanvas expects `graph`, `selectedNodeId`, and `onNodeClick` props.
      Pass `selectedNodeId={null}` and `onNodeClick={() => undefined}` — the
      landing page does not need node selection or detail panel.
    - Do NOT import GraphCanvas statically. Only the dynamic() import above is
      correct. A static import will cause an SSR crash.
    - The existing setError state, error display, and isLoading/setIsLoading
      logic are unchanged.
    - Preserve the existing HeroSection JSX structure for the left column
      (headline, paragraph, form, error display) exactly as-is.
  </action>
  <verify>
    <automated>cd "/Users/uzi/Documents/Git Projects/instagraph-vc" && grep -n "dynamic\|VCGraph\|setGraph\|GraphCanvas" apps/web/components/landing/HeroSection.tsx</automated>
    <manual>
      1. Run `pnpm dev` from repo root.
      2. Visit http://localhost:3000.
      3. Confirm right column shows animated DemoGraph (pre-submission state).
      4. Paste a short funding announcement (at least 200 chars) into the textarea and submit.
      5. After loading completes, confirm the right column now shows a live interactive Cytoscape graph.
      6. Confirm a "Sign up free" caption appears below the graph.
      7. Confirm no console errors about SSR or window.
    </manual>
  </verify>
  <done>
    - HeroSection.tsx contains dynamic GraphCanvas import with ssr:false
    - State is VCGraph | null (not { nodes, edges })
    - API success handler calls setGraph(vcGraph)
    - Right column renders GraphCanvas when graph is truthy, DemoGraph otherwise
    - Sign up to save prompt appears as caption under the result graph
    - TypeScript compiles without errors (pnpm typecheck)
    - UAT Gap 2 is closed: submitting text generates and visually renders a graph
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TypeScript compiles cleanly</name>
  <files>apps/web/components/landing/HeroSection.tsx</files>
  <action>
    Run the Next.js TypeScript compiler check scoped to the web app to confirm
    the rewritten HeroSection.tsx has no type errors.

    Command: `cd "/Users/uzi/Documents/Git Projects/instagraph-vc" && pnpm --filter @graphvc/web typecheck`

    If typecheck is not available as a script, run:
    `cd "/Users/uzi/Documents/Git Projects/instagraph-vc/apps/web" && npx tsc --noEmit 2>&1 | head -30`

    Expected: zero errors relating to HeroSection.tsx.

    Known pre-existing environment errors (module resolution for next/*) are
    acceptable and do not indicate problems with HeroSection.tsx — these were
    documented in the 05-03-SUMMARY.md as unrelated environment issues.

    If there are NEW errors in HeroSection.tsx (not pre-existing), fix them
    before completing this task. Common issues to check:
    - VCGraph imported as type only (import type) — correct
    - GraphCanvas props match: graph: VCGraph, selectedNodeId: string | null,
      onNodeClick: (id: string | null) => void
    - dynamic() return type is compatible with JSX rendering
  </action>
  <verify>
    <automated>cd "/Users/uzi/Documents/Git Projects/instagraph-vc" && pnpm --filter @graphvc/web exec tsc --noEmit 2>&1 | grep "HeroSection" || echo "NO_HEROSECTION_ERRORS"</automated>
  </verify>
  <done>
    TypeScript reports no errors attributable to HeroSection.tsx.
    The grep for "HeroSection" in tsc output returns no results (or outputs NO_HEROSECTION_ERRORS).
  </done>
</task>

</tasks>

<verification>
# Confirm dynamic import is present
grep -n "dynamic.*GraphCanvas.*ssr.*false" "/Users/uzi/Documents/Git Projects/instagraph-vc/apps/web/components/landing/HeroSection.tsx"

# Confirm VCGraph state
grep -n "VCGraph | null" "/Users/uzi/Documents/Git Projects/instagraph-vc/apps/web/components/landing/HeroSection.tsx"

# Confirm setGraph is called in the success handler
grep -n "setGraph(vcGraph)" "/Users/uzi/Documents/Git Projects/instagraph-vc/apps/web/components/landing/HeroSection.tsx"

# Confirm GraphCanvas is rendered conditionally
grep -n "GraphCanvas" "/Users/uzi/Documents/Git Projects/instagraph-vc/apps/web/components/landing/HeroSection.tsx"
</verification>

<success_criteria>
- HeroSection.tsx stores VCGraph | null in state (not { nodes, edges })
- posthog.init() call removed (was in providers.tsx, not this file — no change needed)
- GraphCanvas is dynamically imported with ssr:false
- Right column renders GraphCanvas with live graph data on success
- Right column renders DemoGraph when no graph is stored (initial state)
- Sign up to save prompt appears as caption beneath the result graph
- TypeScript reports no new errors for HeroSection.tsx
- UAT test 9 ("anonymous trial: graph generation from landing page") passes
</success_criteria>

<output>
After completion, create `.planning/phases/05-landing-page-observability/05-06-SUMMARY.md`
</output>
